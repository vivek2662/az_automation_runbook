parameters:
- name: RunbookName
  type: string
#- name: RunbookFolder
#  type: string
- name: ArtifactName
  type: string
#- name: TargetEnvironment
 # type: string #example dev,pre-prod,prod to add after runbook_name

steps:
  - checkout: self
    displayName: "Checkout Source Code"

# Validataing the runbook using the poweshell script
  - task: PowerShell@2
    inputs:
      targetType: 'inline'
      script: |
        $filePath = "$(Build.SourcesDirectory)/${{ parameters.RunbookName }}"
              Write-Host "Validating syntax for $filePath"
              $content = Get-Content $filePath -Raw
              [void][System.Management.Automation.PSScriptAnalyzer]::AnalyzeScript($content)
  - task: CopyFiles@2
    inputs:
      SourceFolder: '$(Build.SourcesDirectory)'
      Contents: '**' # we need to try with runbook name or else it will take all files anything is fine
      TargetFolder: '$(Build.ArtifactStagingDirectory)'

  - task: PublishPipelineArtifact@1
    inputs:
      targetPath: '$(Pipeline.Workspace)' # need to check for the pipeline workspace or the artifact staging directory
      artifact: '${{ parameters.ArtifactName }}'
      publishLocation: 'pipeline'

